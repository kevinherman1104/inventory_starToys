{% extends "base.html" %}
{% block content %}
<div class="row">
    <!-- Left side: Edit existing items -->
    <div class="col-md-8">
        <h2>Edit Invoice #{{ invoice.id }}</h2>

        <form method="post">
            <div class="mb-3">
                <label>Customer Name</label>
                <input type="text" class="form-control" name="customer_name" value="{{ invoice.customer_name }}">
            </div>

            <h5>Existing Items</h5>
            <table class="table table-bordered align-middle">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Image</th>
                        <th>Qty</th>
                        <th>Price</th>
                        <th>Subtotal</th>
                        <th>Remove</th>
                    </tr>
                </thead>
                <tbody>
                {% for item in items %}
                    <tr>
                        <td>{{ item.name }}</td>
                        <td>
                            {% if item.image_url %}
                            <img src="{{ item.image_url }}" class="thumb" style="max-width:50px">
                            {% endif %}
                        </td>
                        <td>
                            <input type="hidden" name="item_id" value="{{ item.id }}">
                            <input type="number" name="quantity" class="form-control" value="{{ item.quantity }}">
                        </td>
                        <td>
                            <input type="number" step="0.01" name="price" class="form-control" value="{{ item.price }}">
                        </td>
                        <td>{{ "%.2f"|format(item.subtotal) }}</td>
                        <td class="text-center">
                            <input type="checkbox" name="remove_item" value="{{ item.id }}">
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>

            <button type="submit" class="btn btn-success">ðŸ’¾ Save Changes</button>
            <a href="{{ url_for('invoice_detail', invoice_id=invoice.id) }}" class="btn btn-secondary">Cancel</a>
        </form>
    </div>

    <!-- Right side: Add new items -->
    <div class="col-md-4">
        <h5>Add New Items</h5>
        <div id="new-items">
            <div class="new-item mb-3">
                <select class="form-select" name="new_product_id">
                    <option value="">-- Select Product --</option>
                    {% for p in products %}
                    <option value="{{ p.id }}">{{ p.product_id }} - {{ p.name }}</option>
                    {% endfor %}
                </select>
                <input type="number" name="new_quantity" class="form-control mt-1" placeholder="Qty">
                <input type="number" step="0.01" name="new_price" class="form-control mt-1" placeholder="Price">
            </div>
        </div>
        <button type="button" class="btn btn-sm btn-outline-primary mt-2" onclick="addNewItem()">âž• Add Another</button>
    </div>
</div>

<script>
function addNewItem() {
    const container = document.getElementById('new-items');
    const div = document.createElement('div');
    div.classList.add('new-item','mb-3');
    div.innerHTML = `
        <select class="form-select" name="new_product_id">
            <option value="">-- Select Product --</option>
            {% for p in products %}
            <option value="{{ p.id }}">{{ p.product_id }} - {{ p.name }}</option>
            {% endfor %}
        </select>
        <input type="number" name="new_quantity" class="form-control mt-1" placeholder="Qty">
        <input type="number" step="0.01" name="new_price" class="form-control mt-1" placeholder="Price">
    `;
    container.appendChild(div);
}
</script>
{% endblock %}
